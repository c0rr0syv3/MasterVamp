<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="shortcut icon" href="assets/Images/icon.svg" type="image/svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vampiro: A Máscara — Início</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;600;700&family=EB+Garamond:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="landing.css">
    <style>
    /* ── DASHBOARD LARGO ── */
    .dashboard-panel { width: 100%; max-width: 640px; }

    .dash-top {
        display: flex; align-items: center;
        justify-content: space-between; gap: 12px; flex-wrap: wrap;
        margin-bottom: 4px;
    }
    .dash-quick { display: flex; gap: 8px; flex-wrap: wrap; }

    /* ── FICHAS ── */
    .fichas-section { margin-top: 18px; }
    .fichas-header {
        display: flex; align-items: center;
        justify-content: space-between;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(138,0,0,0.2);
        margin-bottom: 12px;
    }
    .fichas-title {
        font-family: 'Cinzel', serif; font-size: 10px;
        letter-spacing: 0.25em; text-transform: uppercase;
        color: var(--gold);
        display: flex; align-items: center; gap: 8px;
    }
    .fichas-count {
        font-family: 'Cinzel', serif; font-size: 9px;
        padding: 2px 8px;
        border: 1px solid rgba(138,0,0,0.3);
        color: var(--blood-bright);
        background: rgba(138,0,0,0.08);
    }
    .fichas-loading {
        text-align: center; padding: 24px 0;
        font-family: 'Cinzel', serif; font-size: 10px;
        letter-spacing: 0.2em; color: var(--gold-dim);
        text-transform: uppercase;
    }
    .fichas-empty {
        text-align: center; padding: 28px 16px;
        border: 1px dashed rgba(138,0,0,0.2);
    }
    .fichas-empty-text {
        font-family: 'EB Garamond', serif; font-size: 15px;
        color: var(--parchment); font-style: italic; opacity: 0.45;
    }
    .fichas-grid { display: flex; flex-direction: column; gap: 8px; }

    /* Card */
    .ficha-card {
        display: flex; align-items: center; gap: 12px;
        padding: 10px 12px;
        border: 1px solid rgba(138,0,0,0.2);
        background: linear-gradient(90deg, rgba(20,12,8,0.85) 0%, rgba(14,9,6,0.92) 100%);
        transition: border-color 0.2s; position: relative; overflow: hidden;
    }
    .ficha-card::before {
        content: ''; position: absolute;
        left: 0; top: 0; bottom: 0; width: 2px;
        background: var(--blood-dark); transition: background 0.2s;
    }
    .ficha-card:hover { border-color: rgba(138,0,0,0.5); }
    .ficha-card:hover::before { background: var(--blood-bright); }

    .ficha-foto {
        width: 44px; height: 54px;
        object-fit: cover; object-position: center top;
        flex-shrink: 0; filter: grayscale(20%) brightness(0.85);
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(138,0,0,0.2);
    }
    .ficha-foto-ph {
        width: 44px; height: 54px; flex-shrink: 0;
        background: rgba(0,0,0,0.3);
        border: 1px solid rgba(138,0,0,0.12);
        display: flex; align-items: center; justify-content: center;
    }
    .ficha-info { flex: 1; min-width: 0; }
    .ficha-nome {
        font-family: 'Cinzel', serif; font-size: 13px; color: var(--bone);
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .ficha-meta {
        font-family: 'EB Garamond', serif; font-size: 12px;
        color: var(--parchment); opacity: 0.5; margin-top: 2px;
    }
    .ficha-badges { display: flex; gap: 4px; margin-top: 5px; flex-wrap: wrap; }
    .badge {
        font-family: 'Cinzel', serif; font-size: 7.5px;
        letter-spacing: 0.1em; text-transform: uppercase;
        padding: 2px 6px; border: 1px solid;
    }
    .badge-desc { border-color: rgba(201,168,76,0.3); color: var(--gold-dim); }
    .badge-hist { border-color: rgba(100,100,200,0.3); color: #8888cc; }

    .ficha-actions { display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; }

    /* ── MODAL ── */
    .modal-overlay {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.88); z-index: 200;
        display: flex; align-items: center; justify-content: center;
        backdrop-filter: blur(4px); padding: 16px;
    }
    .modal-box {
        background: linear-gradient(180deg, rgba(22,14,10,0.99) 0%, rgba(12,8,5,1) 100%);
        border: 1px solid rgba(138,0,0,0.4);
        width: 100%; max-width: 500px; position: relative;
        animation: panelSlide 0.28s ease-out;
        max-height: 90vh; overflow-y: auto;
    }
    .modal-box::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
        background: linear-gradient(90deg, transparent, var(--blood), var(--blood-bright), var(--blood), transparent);
    }
    @keyframes panelSlide {
        from { opacity: 0; transform: translateY(-14px) scale(0.97); }
        to   { opacity: 1; transform: none; }
    }
    .modal-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 16px 20px 12px;
        border-bottom: 1px solid rgba(138,0,0,0.2);
    }
    .modal-header h3 {
        font-family: 'Cinzel', serif; font-size: 11px;
        letter-spacing: 0.22em; text-transform: uppercase; color: var(--gold);
    }
    .modal-close {
        background: none; border: none; color: var(--gold-dim);
        cursor: pointer; font-size: 18px; line-height: 1; padding: 0 4px; transition: color 0.2s;
    }
    .modal-close:hover { color: var(--blood-bright); }
    .modal-body { padding: 18px 20px; display: flex; flex-direction: column; gap: 14px; }
    .modal-char-name {
        font-family: 'Cinzel Decorative', serif; font-size: 17px;
        color: var(--blood-bright); text-align: center;
        text-shadow: 0 0 14px rgba(180,0,0,0.4);
    }
    .modal-tabs {
        display: flex; border-bottom: 1px solid rgba(138,0,0,0.2); margin: 0 -20px;
    }
    .modal-tab {
        flex: 1; font-family: 'Cinzel', serif; font-size: 10px;
        letter-spacing: 0.18em; text-transform: uppercase;
        padding: 10px 0; background: transparent; border: none;
        color: var(--gold-dim); cursor: pointer; transition: all 0.2s; position: relative;
    }
    .modal-tab::after {
        content: ''; position: absolute; bottom: -1px; left: 0; right: 0;
        height: 2px; background: var(--blood-bright); opacity: 0; transition: opacity 0.2s;
    }
    .modal-tab.active { color: var(--bone); }
    .modal-tab.active::after { opacity: 1; }

    .modal-section-lbl {
        font-family: 'Cinzel', serif; font-size: 9px;
        letter-spacing: 0.18em; text-transform: uppercase; color: var(--gold-dim);
        display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
    }
    .modal-section-lbl::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, rgba(201,168,76,0.18), transparent); }

    .specs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .spec-f { display: flex; flex-direction: column; gap: 3px; }
    .spec-f label {
        font-family: 'Cinzel', serif; font-size: 8px;
        letter-spacing: 0.15em; text-transform: uppercase; color: var(--gold-dim);
    }
    .modal-input {
        background: transparent; border: none;
        border-bottom: 1px solid rgba(201,168,76,0.2);
        color: var(--bone); font-family: 'EB Garamond', serif; font-size: 14px;
        padding: 5px 2px; outline: none; width: 100%; transition: border-color 0.2s;
    }
    .modal-input:focus { border-bottom-color: var(--blood-bright); }
    .modal-input::placeholder { color: rgba(200,184,154,0.22); font-style: italic; }
    .modal-textarea {
        width: 100%; background: rgba(0,0,0,0.25);
        border: 1px solid rgba(201,168,76,0.12);
        border-bottom-color: rgba(201,168,76,0.28);
        color: var(--bone); font-family: 'EB Garamond', serif; font-size: 14px;
        padding: 9px 11px; outline: none; resize: vertical; min-height: 72px; transition: border-color 0.2s;
    }
    .modal-textarea:focus { border-color: rgba(138,0,0,0.4); }
    .modal-textarea::placeholder { color: rgba(200,184,154,0.22); font-style: italic; }
    .modal-hint { font-size: 11px; color: var(--parchment); opacity: 0.35; font-style: italic; margin-top: 4px; }

    .hist-preview {
        display: flex; align-items: center; gap: 8px;
        padding: 8px 12px; border: 1px solid rgba(100,100,200,0.2);
        background: rgba(40,40,80,0.1); margin-top: 8px;
    }
    .hist-preview a {
        color: #8888cc; font-family: 'EB Garamond', serif; font-size: 13px;
        text-decoration: none; word-break: break-all;
    }
    .hist-preview a:hover { color: #aaaaee; text-decoration: underline; }

    .modal-footer { padding: 0 20px 20px; display: flex; gap: 8px; }
    </style>
    
</head>
<body class="landing-body">

    <canvas id="particles-canvas"></canvas>
    <div class="corner corner-tl"></div>
    <div class="corner corner-tr"></div>
    <div class="corner corner-bl"></div>
    <div class="corner corner-br"></div>

    <!-- HERO -->
    <div class="hero">
        <div class="sigil">
            <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="60" cy="60" r="56" stroke="#8a0000" stroke-width="1" opacity="0.5"/>
                <circle cx="60" cy="60" r="46" stroke="#8a0000" stroke-width="0.5" opacity="0.3"/>
                <path d="M60 10 L60 110 M10 60 L110 60" stroke="#8a0000" stroke-width="1.5" opacity="0.6"/>
                <path d="M60 10 L70 30 L60 25 L50 30 Z" fill="#8a0000" opacity="0.7"/>
                <path d="M60 35 L80 75 L40 75 Z" stroke="#c9a84c" stroke-width="0.8" fill="none" opacity="0.4"/>
                <circle cx="60" cy="60" r="4" fill="#8a0000" opacity="0.8"/>
                <path d="M60 4 L62 8 L60 7 L58 8 Z" fill="#8a0000" opacity="0.5"/>
                <path d="M116 60 L112 62 L113 60 L112 58 Z" fill="#8a0000" opacity="0.5"/>
                <path d="M60 116 L58 112 L60 113 L62 112 Z" fill="#8a0000" opacity="0.5"/>
                <path d="M4 60 L8 58 L7 60 L8 62 Z" fill="#8a0000" opacity="0.5"/>
            </svg>
        </div>
        <div class="title-block">
            <p class="pre-title">Bem-vindo às Trevas</p>
            <h1>VAMPIRO</h1>
            <h2>A Máscara <span class="edition">· 3ª Edição</span></h2>
            <div class="title-ornament"><span></span><span class="diamond">◆</span><span></span></div>
        </div>
    </div>

    <!-- PAINEL CENTRAL -->
    <div class="panel-wrapper">

        <!-- Botões iniciais -->
        <div id="main-actions" class="action-grid">
            <button class="btn-gothic btn-primary" onclick="showLogin()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                Acessar Conta
            </button>
            <button class="btn-gothic btn-secondary" onclick="triggerImport()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                Importar Ficha
            </button>
            <input type="file" id="file-upload" accept=".json" style="display:none">
        </div>

        <!-- Login / Cadastro -->
        <div id="login-section" class="auth-panel" style="display:none;">
            <div class="auth-tabs">
                <button class="auth-tab active" id="tab-login" onclick="switchTab('login')">Entrar</button>
                <button class="auth-tab" id="tab-register" onclick="switchTab('register')">Cadastrar</button>
            </div>
            <div class="auth-fields">
                <div class="field-group">
                    <label>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Nome de Usuário
                    </label>
                    <input type="text" id="username-input" placeholder="Seu nome nas sombras...">
                </div>
                <div class="field-group">
                    <label>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        Senha Secreta
                    </label>
                    <input type="password" id="password-input" placeholder="••••••••">
                </div>
                <div id="master-checkbox-container" class="master-check" style="display:none;">
                    <label class="check-label">
                        <input type="checkbox" id="is-master-check">
                        <span class="check-box"></span>
                        Sou o Narrador / Mestre
                    </label>
                </div>
            </div>
            <div class="auth-actions">
                <button class="btn-gothic btn-primary full" id="btn-auth-action" onclick="handleAuth()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    Acessar
                </button>
                <button class="btn-ghost" onclick="hideLogin()">Cancelar</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard-section" class="dashboard-panel" style="display:none;">

            <div class="dash-top">
                <div class="welcome-line" style="margin-bottom:0;">
                    <span class="welcome-text">Bem-vindo(a),</span>
                    <span class="welcome-user" id="display-user"></span>
                </div>
                <div class="dash-quick">
                    <button class="btn-gothic btn-primary" onclick="window.location.href='mesa/mesa.html'" style="padding:7px 14px; font-size:10px;">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                        Mesa Virtual
                    </button>
                    <button class="btn-ghost small" onclick="triggerImport()">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Importar
                    </button>
                    <button class="btn-ghost small danger" onclick="logout()">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        Sair
                    </button>
                </div>
            </div>

            <div class="dash-divider"><span>◆</span></div>

            <!-- FICHAS -->
            <div class="fichas-section">
                <div class="fichas-header">
                    <div class="fichas-title">
                        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Minhas Fichas
                        <span class="fichas-count" id="fichas-count">—</span>
                    </div>
                    <button class="btn-gothic btn-secondary" onclick="createNewSheet()" style="padding:6px 14px; font-size:10px;">
                        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Nova Ficha
                    </button>
                </div>
                <div id="fichas-list">
                    <div class="fichas-loading">Invocando pergaminhos...</div>
                </div>
            </div>

        </div>
    </div>

    <!-- MODAL: Descritivo + História -->
    <div id="modal-overlay" class="modal-overlay" style="display:none;" onclick="fecharModalFora(event)">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Perfil do Personagem</h3>
                <button class="modal-close" onclick="fecharModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="modal-char-name" id="modal-char-name">—</div>

                <div class="modal-tabs">
                    <button class="modal-tab active" id="modal-tab-desc" onclick="switchModalTab('desc')">Descrição Física</button>
                    <button class="modal-tab" id="modal-tab-hist" onclick="switchModalTab('hist')">História</button>
                </div>

                <!-- Aba: Descrição -->
                <div id="modal-panel-desc">
                    <div class="modal-section-lbl">Especificações Físicas</div>
                    <div class="specs-grid">
                        <div class="spec-f"><label>Idade aparente</label><input class="modal-input" id="spec-idade" placeholder="Ex: 30 anos"></div>
                        <div class="spec-f"><label>Altura</label><input class="modal-input" id="spec-altura" placeholder="Ex: 1,80m"></div>
                        <div class="spec-f"><label>Tipo físico</label><input class="modal-input" id="spec-tipo" placeholder="Ex: Atlético"></div>
                        <div class="spec-f"><label>Olhos</label><input class="modal-input" id="spec-olhos" placeholder="Ex: Castanhos"></div>
                        <div class="spec-f"><label>Cabelo</label><input class="modal-input" id="spec-cabelo" placeholder="Ex: Preto, curto"></div>
                        <div class="spec-f"><label>Traços marcantes</label><input class="modal-input" id="spec-tracos" placeholder="Ex: Cicatriz"></div>
                    </div>
                    <div class="modal-section-lbl" style="margin-top:14px;">Descrição Geral</div>
                    <textarea class="modal-textarea" id="spec-descricao" placeholder="Como este personagem se apresenta ao mundo? Maneiras, roupas, postura, aura..."></textarea>
                </div>

                <!-- Aba: História -->
                <div id="modal-panel-hist" style="display:none;">
                    <div class="modal-section-lbl">Link da História</div>
                    <input class="modal-input" id="hist-link" placeholder="https://docs.google.com/... ou qualquer URL" oninput="previewHistLink(this.value)">
                    <p class="modal-hint">Apenas links externos são aceitos — Google Docs, Notion, Wattpad, etc.</p>
                    <div id="hist-preview" class="hist-preview" style="display:none;">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#8888cc" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                        <a id="hist-anchor" href="#" target="_blank" rel="noopener">—</a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-gothic btn-primary full" onclick="salvarDescritivo()">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
                    Salvar
                </button>
                <button class="btn-ghost" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="landing-toast" id="landing-toast"></div>

    <script src="db.js"></script>
    <script src="landing.js"></script>
    <script src="particles.js"></script>
</body>
</html>